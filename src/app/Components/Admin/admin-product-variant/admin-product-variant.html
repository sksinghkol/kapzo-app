<div class="container mt-4">
  <h3 class="text-center mb-4">üõçÔ∏è Manage Product Variants</h3>

  <table class="table table-bordered table-hover table-striped align-middle shadow-sm">
    <thead class="table-dark text-center">
      <tr>
        <th>Product</th>
        <th>Size</th>
        <th>Color</th>
        <th>SKU</th>
        <th>MRP Price</th>
        <th>Current Price</th>
        <th>Discount %</th>
        <th>Stock Qty</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let v of variants; let i = index">
        <td>
          <select [(ngModel)]="v.product_id" class="form-select" [disabled]="!v.isEditing" (change)="calculateDiscount(v)">
            <option value="">Select Product</option>
            <option *ngFor="let p of products" [value]="p.product_id">{{ p.name }}</option>
          </select>
        </td>
        <td>
          <select [(ngModel)]="v.size_id" class="form-select" [disabled]="!v.isEditing">
            <option value="">Select Size</option>
            <option *ngFor="let s of sizes" [value]="s.size_id">{{ s.size_name }}</option>
          </select>
        </td>
        <td>
          <select [(ngModel)]="v.color_id" class="form-select" [disabled]="!v.isEditing">
            <option value="">Select Color</option>
            <option *ngFor="let c of colors" [value]="c.color_id">{{ c.color_name }}</option>
          </select>
        </td>
        <td>
          <input type="text" [(ngModel)]="v.sku" class="form-control" placeholder="Enter SKU" [readonly]="!v.isEditing"/>
        </td>
        <td>
          <input type="number" [(ngModel)]="v.mrp_price" (input)="calculateDiscount(v)" class="form-control" placeholder="MRP" [readonly]="!v.isEditing"/>
        </td>
        <td>
          <input type="number" [(ngModel)]="v.current_price" (input)="calculateDiscount(v)" class="form-control" placeholder="Current Price" [readonly]="!v.isEditing"/>
        </td>
        <td class="text-center fw-bold text-success">{{ v.discount_percentage }} %</td>
        <td>
          <input type="number" [(ngModel)]="v.stock_quantity" class="form-control" placeholder="Stock Qty" [readonly]="!v.isEditing"/>
        </td>
        <td class="text-center">
          <ng-container *ngIf="!v.isEditing; else editMode">
            <button class="btn btn-warning btn-sm me-2" (click)="editRow(v)">‚úèÔ∏è Edit</button>
            <button class="btn btn-danger btn-sm" (click)="confirmDelete(i)">‚ùå Delete</button>
          </ng-container>
          <ng-template #editMode>
            <button class="btn btn-success btn-sm me-2" (click)="updateVariant(v)">üíæ Save</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelEdit(v)">‚Ü©Ô∏è Cancel</button>
          </ng-template>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="d-flex justify-content-between mt-3">
    <button class="btn btn-primary" (click)="addRow()">‚ûï Add Row</button>
  </div>
</div>
